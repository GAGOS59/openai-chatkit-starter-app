*/
.row { display: flex; gap: 10px; margin-bottom: 12px; }
.me, .bot { max-width: 80%; padding: 12px 14px; border-radius: 14px; line-height: 1.45; font-size: 16px; }
.me { margin-left: auto; background: var(--bleu); color: #fff; border-bottom-right-radius: 4px; }
.bot { margin-right: auto; background: var(--beige); color: var(--bleu); border-bottom-left-radius: 4px; border: 1px solid var(--bleu); }
.input { display: flex; gap: 8px; border-top: 1px solid var(--bleu); padding: 12px; background: #fff; }
input[type=text] { flex: 1; padding: 12px; border: 1px solid var(--bleu); border-radius: 10px; font-size: 16px; color: var(--bleu); background: #fff; }
button { padding: 12px 16px; background: var(--bleu); color: #fff; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; }
button:disabled { opacity: .6; cursor: not-allowed; }
.note { font-size: 14px; margin: 16px 0; }
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<header>
<h1>Guide EFT – École EFT France</h1>
<p class="sub">Écrivez simplement « Bonjour » pour commencer. Le guide applique l’EFT officielle (Gary Craig, Geneviève Gagos).</p>
</header>
<div id="chat" class="chat"></div>
<div class="input">
<input id="msg" type="text" placeholder="Votre message…" autocomplete="off" />
<button id="send">Envoyer</button>
</div>
</div>
<p class="note">En cas de difficulté ou d’intensité élevée, interrompez la séance et contactez un praticien EFT certifié.</p>
</div>


<script>
const chatEl = document.getElementById('chat');
const msgEl = document.getElementById('msg');
const sendBtn = document.getElementById('send');


const history = [];


function addBubble(text, who) {
const row = document.createElement('div');
row.className = 'row';
const b = document.createElement('div');
b.className = who === 'me' ? 'me' : 'bot';
b.textContent = text;
row.appendChild(b);
chatEl.appendChild(row);
chatEl.scrollTop = chatEl.scrollHeight;
}


// Message d’accueil minimal
addBubble('Bonjour et bienvenue. Que ressens-tu exactement ici et maintenant ?', 'bot');


async function send() {
const text = msgEl.value.trim();
if (!text) return;
addBubble(text, 'me');
msgEl.value = '';
sendBtn.disabled = true;
try {
const resp = await fetch('/api/eft-chat', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ message: text, history })
});
const data = await resp.json();
if (!resp.ok) {
addBubble('Une erreur est survenue. Merci de réessayer plus tard.', 'bot');
console.error('API error', data);
} else {
const reply = data.reply || '(aucune réponse)';
addBubble(reply, 'bot');
// Empile l’historique vers l’API (facultatif, court)
history.push({ role: 'user', content: text });
history.push({ role: 'assistant', content: reply });
}
} catch (e) {
addBubble('Impossible de contacter le serveur pour le moment.', 'bot');
console.error(e);
} finally {
sendBtn.disabled = false;
msgEl.focus();
}
}


sendBtn.addEventListener('click', send);
msgEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') send(); });
</script>
</body>
</html>
